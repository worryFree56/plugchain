(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{453:function(t,e,s){"use strict";s.r(e);var a=s(57),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"disk-usage-optimization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#disk-usage-optimization"}},[t._v("#")]),t._v(" Disk Usage Optimization")]),t._v(" "),s("p",[t._v("Customize the configuration settings to lower the disk requirements for your validator node")]),t._v(" "),s("p",[t._v("Blockchain database tends to grow over time, depending e.g. on block\nspeed and transaction amount. For Plugchain, we are talking about close to\n100GB of disk usage in first two weeks.")]),t._v(" "),s("p",[t._v("There are few configurations that can be done to reduce the required\ndisk usage quite significantly. Some of these changes take full effect\nonly when you do the configuration and start syncing from start with\nthem in use.")]),t._v(" "),s("h2",{attrs:{id:"indexing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#indexing"}},[t._v("#")]),t._v(" Indexing")]),t._v(" "),s("p",[t._v("If you do not need to query transactions from the specific node, you can\ndisable indexing. On "),s("code",[t._v("config.toml")]),t._v(" set")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("indexer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"null"')]),t._v("\n")])])]),s("p",[t._v("If you do this on already synced node, the collected index is not purged\nautomatically, you need to delete it manually. The index is located\nunder the database directory with name "),s("code",[t._v("data/tx_index.db/")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"state-sync-snapshots"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#state-sync-snapshots"}},[t._v("#")]),t._v(" State-sync snapshots")]),t._v(" "),s("p",[t._v("I believe this was disabled by default on Plugchain, but listing it in any\ncase here. On "),s("code",[t._v("app.toml")]),t._v(" set")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("snapshot-interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("Note that if state-sync was enabled on the network and working properly,\nit would allow one to sync a new node in few minutes. But this node\nwould not have the history.")]),t._v(" "),s("h2",{attrs:{id:"configure-pruning"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-pruning"}},[t._v("#")]),t._v(" Configure pruning")]),t._v(" "),s("p",[t._v("By default every 500th state, and the last 100 states are kept. This\nconsumes a lot of disk space on long run, and can be optimized with\nfollowing custom configuration:")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("pruning")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"custom"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("pruning-keep-recent")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("pruning-keep-every")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("pruning-interval")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10"')]),t._v("\n")])])]),s("p",[t._v("Configuring "),s("code",[t._v('pruning-keep-recent = "0"')]),t._v(" might sound tempting, but this\nwill risk database corruption if the "),s("code",[t._v("plugchaind")]),t._v(" is killed for any reason.\nThus, it is recommended to keep the few latest states.")]),t._v(" "),s("h2",{attrs:{id:"logging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[t._v("#")]),t._v(" Logging")]),t._v(" "),s("p",[t._v("By default the logging level is set to "),s("code",[t._v("info")]),t._v(", and this produces a lot of\nlogs. This log level might be good when starting up to see that the\nnode starts syncing properly. However, after you see the syncing is\ngoing smoothly, you can lower the log level to "),s("code",[t._v("warn")]),t._v(" (or "),s("code",[t._v("error")]),t._v("). On\n"),s("code",[t._v("config.toml")]),t._v(" set the following")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("log_level")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"warn"')]),t._v("\n")])])]),s("p",[t._v("Also ensure your log rotation is configured properly.")]),t._v(" "),s("h2",{attrs:{id:"results"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#results"}},[t._v("#")]),t._v(" Results")]),t._v(" "),s("p",[t._v("Below is the disk usage after two weeks of Plugchain Arsia Mons testnet. The default\nconfiguration results in disk usage of 90GB.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(".3G    ./state.db\n70G     ./application.db\n20K     ./snapshots/metadata.db\n24K     ./snapshots\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(".0G    ./blockstore.db\n20K     ./evidence.db\n1018M   ./cs.wal\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(".7G    ./tx_index.db\n90G     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("This optimized configuration has reduced the disk usage to 17 GB.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("17G     "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".1G    ./cs.wal\n946M    ./application.db\n20K     ./evidence.db\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(".1G    ./blockstore.db\n24K     ./snapshots\n20K     ./snapshots/metadata.db\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(".3G    ./state.db\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);