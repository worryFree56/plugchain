<!DOCTYPE html>
<html lang="简体中文">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>软件升级 | Plug Chain 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Plug Chain 文档">
    
    <link rel="preload" href="/plugchain/assets/css/0.styles.bfd69eec.css" as="style"><link rel="preload" href="/plugchain/assets/js/app.032ebf29.js" as="script"><link rel="preload" href="/plugchain/assets/js/2.27ddde56.js" as="script"><link rel="preload" href="/plugchain/assets/js/114.6b3b13cd.js" as="script"><link rel="prefetch" href="/plugchain/assets/js/10.6a2b4c7c.js"><link rel="prefetch" href="/plugchain/assets/js/100.e3d0642d.js"><link rel="prefetch" href="/plugchain/assets/js/101.2ed64956.js"><link rel="prefetch" href="/plugchain/assets/js/102.61a524d0.js"><link rel="prefetch" href="/plugchain/assets/js/103.5763eff4.js"><link rel="prefetch" href="/plugchain/assets/js/104.39c0aa70.js"><link rel="prefetch" href="/plugchain/assets/js/105.05b5a67c.js"><link rel="prefetch" href="/plugchain/assets/js/106.d5e891de.js"><link rel="prefetch" href="/plugchain/assets/js/107.6dadcb1e.js"><link rel="prefetch" href="/plugchain/assets/js/108.21465a65.js"><link rel="prefetch" href="/plugchain/assets/js/109.0a9541c6.js"><link rel="prefetch" href="/plugchain/assets/js/11.b2430674.js"><link rel="prefetch" href="/plugchain/assets/js/110.6b77c835.js"><link rel="prefetch" href="/plugchain/assets/js/111.6999b6bb.js"><link rel="prefetch" href="/plugchain/assets/js/112.fb7b9951.js"><link rel="prefetch" href="/plugchain/assets/js/113.cab17121.js"><link rel="prefetch" href="/plugchain/assets/js/115.5cdde410.js"><link rel="prefetch" href="/plugchain/assets/js/116.37754711.js"><link rel="prefetch" href="/plugchain/assets/js/117.d1b1427b.js"><link rel="prefetch" href="/plugchain/assets/js/118.ad9a1ca5.js"><link rel="prefetch" href="/plugchain/assets/js/119.84d3c2b2.js"><link rel="prefetch" href="/plugchain/assets/js/12.8f2594a2.js"><link rel="prefetch" href="/plugchain/assets/js/120.be17e49b.js"><link rel="prefetch" href="/plugchain/assets/js/121.09c2efd5.js"><link rel="prefetch" href="/plugchain/assets/js/122.d7795865.js"><link rel="prefetch" href="/plugchain/assets/js/123.f7665737.js"><link rel="prefetch" href="/plugchain/assets/js/124.1026fdd1.js"><link rel="prefetch" href="/plugchain/assets/js/125.f59ed69d.js"><link rel="prefetch" href="/plugchain/assets/js/126.8456053c.js"><link rel="prefetch" href="/plugchain/assets/js/127.18b54a89.js"><link rel="prefetch" href="/plugchain/assets/js/128.dc107f49.js"><link rel="prefetch" href="/plugchain/assets/js/13.364bdf00.js"><link rel="prefetch" href="/plugchain/assets/js/14.62b8c815.js"><link rel="prefetch" href="/plugchain/assets/js/15.3f34c4b4.js"><link rel="prefetch" href="/plugchain/assets/js/16.b4384910.js"><link rel="prefetch" href="/plugchain/assets/js/17.c046237c.js"><link rel="prefetch" href="/plugchain/assets/js/18.569f26b1.js"><link rel="prefetch" href="/plugchain/assets/js/19.041d47ce.js"><link rel="prefetch" href="/plugchain/assets/js/20.a6f5e7d2.js"><link rel="prefetch" href="/plugchain/assets/js/21.c3597e09.js"><link rel="prefetch" href="/plugchain/assets/js/22.cdf4c57a.js"><link rel="prefetch" href="/plugchain/assets/js/23.52b657fc.js"><link rel="prefetch" href="/plugchain/assets/js/24.100124d8.js"><link rel="prefetch" href="/plugchain/assets/js/25.b440e2ed.js"><link rel="prefetch" href="/plugchain/assets/js/26.72916075.js"><link rel="prefetch" href="/plugchain/assets/js/27.3401dd0a.js"><link rel="prefetch" href="/plugchain/assets/js/28.da1bf0cc.js"><link rel="prefetch" href="/plugchain/assets/js/29.72ca96c4.js"><link rel="prefetch" href="/plugchain/assets/js/3.b269ed9d.js"><link rel="prefetch" href="/plugchain/assets/js/30.7d0612e0.js"><link rel="prefetch" href="/plugchain/assets/js/31.47030a9a.js"><link rel="prefetch" href="/plugchain/assets/js/32.930d42df.js"><link rel="prefetch" href="/plugchain/assets/js/33.240d5c18.js"><link rel="prefetch" href="/plugchain/assets/js/34.35c6ea88.js"><link rel="prefetch" href="/plugchain/assets/js/35.b8292607.js"><link rel="prefetch" href="/plugchain/assets/js/36.3b5fc7b3.js"><link rel="prefetch" href="/plugchain/assets/js/37.79e02f52.js"><link rel="prefetch" href="/plugchain/assets/js/38.af23d2c1.js"><link rel="prefetch" href="/plugchain/assets/js/39.76264d77.js"><link rel="prefetch" href="/plugchain/assets/js/4.85a3c52a.js"><link rel="prefetch" href="/plugchain/assets/js/40.0669543c.js"><link rel="prefetch" href="/plugchain/assets/js/41.bf5648c7.js"><link rel="prefetch" href="/plugchain/assets/js/42.e5e37eb3.js"><link rel="prefetch" href="/plugchain/assets/js/43.a7edb2b8.js"><link rel="prefetch" href="/plugchain/assets/js/44.3ca5de46.js"><link rel="prefetch" href="/plugchain/assets/js/45.9549400e.js"><link rel="prefetch" href="/plugchain/assets/js/46.263909ee.js"><link rel="prefetch" href="/plugchain/assets/js/47.1ed7e4aa.js"><link rel="prefetch" href="/plugchain/assets/js/48.73d8ec68.js"><link rel="prefetch" href="/plugchain/assets/js/49.ec7eea9c.js"><link rel="prefetch" href="/plugchain/assets/js/5.c059fe48.js"><link rel="prefetch" href="/plugchain/assets/js/50.22208a40.js"><link rel="prefetch" href="/plugchain/assets/js/51.2ac15085.js"><link rel="prefetch" href="/plugchain/assets/js/52.cc217690.js"><link rel="prefetch" href="/plugchain/assets/js/53.5171a605.js"><link rel="prefetch" href="/plugchain/assets/js/54.cd57ddbc.js"><link rel="prefetch" href="/plugchain/assets/js/55.14bdddcb.js"><link rel="prefetch" href="/plugchain/assets/js/56.7209c793.js"><link rel="prefetch" href="/plugchain/assets/js/57.b64eeb40.js"><link rel="prefetch" href="/plugchain/assets/js/58.007b83ca.js"><link rel="prefetch" href="/plugchain/assets/js/59.dfb58043.js"><link rel="prefetch" href="/plugchain/assets/js/6.89300679.js"><link rel="prefetch" href="/plugchain/assets/js/60.02cd7075.js"><link rel="prefetch" href="/plugchain/assets/js/61.878ffc75.js"><link rel="prefetch" href="/plugchain/assets/js/62.482eb6b8.js"><link rel="prefetch" href="/plugchain/assets/js/63.eb4e3d08.js"><link rel="prefetch" href="/plugchain/assets/js/64.5de9ccdd.js"><link rel="prefetch" href="/plugchain/assets/js/65.ce399262.js"><link rel="prefetch" href="/plugchain/assets/js/66.e52d2cd5.js"><link rel="prefetch" href="/plugchain/assets/js/67.25213d9a.js"><link rel="prefetch" href="/plugchain/assets/js/68.f2c08a9f.js"><link rel="prefetch" href="/plugchain/assets/js/69.79d01799.js"><link rel="prefetch" href="/plugchain/assets/js/7.238ac748.js"><link rel="prefetch" href="/plugchain/assets/js/70.6752bf41.js"><link rel="prefetch" href="/plugchain/assets/js/71.8967268b.js"><link rel="prefetch" href="/plugchain/assets/js/72.0150d785.js"><link rel="prefetch" href="/plugchain/assets/js/73.e127e732.js"><link rel="prefetch" href="/plugchain/assets/js/74.67b47119.js"><link rel="prefetch" href="/plugchain/assets/js/75.82901251.js"><link rel="prefetch" href="/plugchain/assets/js/76.3758917e.js"><link rel="prefetch" href="/plugchain/assets/js/77.bc3c8557.js"><link rel="prefetch" href="/plugchain/assets/js/78.23e1762e.js"><link rel="prefetch" href="/plugchain/assets/js/79.c72a2013.js"><link rel="prefetch" href="/plugchain/assets/js/8.87a8e582.js"><link rel="prefetch" href="/plugchain/assets/js/80.9aa59088.js"><link rel="prefetch" href="/plugchain/assets/js/81.ac6768f3.js"><link rel="prefetch" href="/plugchain/assets/js/82.f53cca02.js"><link rel="prefetch" href="/plugchain/assets/js/83.4ce136db.js"><link rel="prefetch" href="/plugchain/assets/js/84.1c82d775.js"><link rel="prefetch" href="/plugchain/assets/js/85.cd959df7.js"><link rel="prefetch" href="/plugchain/assets/js/86.db5fb841.js"><link rel="prefetch" href="/plugchain/assets/js/87.ff055ddd.js"><link rel="prefetch" href="/plugchain/assets/js/88.956dd5c5.js"><link rel="prefetch" href="/plugchain/assets/js/89.c893873c.js"><link rel="prefetch" href="/plugchain/assets/js/9.b203014f.js"><link rel="prefetch" href="/plugchain/assets/js/90.c6b94a88.js"><link rel="prefetch" href="/plugchain/assets/js/91.f2ee3795.js"><link rel="prefetch" href="/plugchain/assets/js/92.0a4e963d.js"><link rel="prefetch" href="/plugchain/assets/js/93.bfab0c8e.js"><link rel="prefetch" href="/plugchain/assets/js/94.8bd75939.js"><link rel="prefetch" href="/plugchain/assets/js/95.0b8e343a.js"><link rel="prefetch" href="/plugchain/assets/js/96.cd44ab9d.js"><link rel="prefetch" href="/plugchain/assets/js/97.1499a0b3.js"><link rel="prefetch" href="/plugchain/assets/js/98.6e8667f5.js"><link rel="prefetch" href="/plugchain/assets/js/99.abfd2496.js">
    <link rel="stylesheet" href="/plugchain/assets/css/0.styles.bfd69eec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/plugchain/zh/" class="home-link router-link-active"><!----> <span class="site-name">Plug Chain 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://zh.plugchain.info/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Plug Chain 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/oracleNetworkProtocol/plugchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社区" class="dropdown-title"><span class="title">加入我们</span> <span class="arrow down"></span></button> <button type="button" aria-label="社区" class="mobile-dropdown-title"><span class="title">加入我们</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/plugchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/Plugchainclub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/plugchain/features/upgrade.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/plugchain/zh/features/upgrade.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://zh.plugchain.info/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Plug Chain 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/oracleNetworkProtocol/plugchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="社区" class="dropdown-title"><span class="title">加入我们</span> <span class="arrow down"></span></button> <button type="button" aria-label="社区" class="mobile-dropdown-title"><span class="title">加入我们</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://t.me/plugchain" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Telegram
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/Plugchainclub" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/plugchain/features/upgrade.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/plugchain/zh/features/upgrade.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>快速开始</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>概念</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>功能模块</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/plugchain/zh/features/bank.html" class="sidebar-link">Bank模块</a></li><li><a href="/plugchain/zh/features/distribution.html" class="sidebar-link">收益分配</a></li><li><a href="/plugchain/zh/features/governance.html" class="sidebar-link">链上治理</a></li><li><a href="/plugchain/zh/features/liquidity.html" class="sidebar-link">Liquidity</a></li><li><a href="/plugchain/zh/features/mint.html" class="sidebar-link">通货膨胀</a></li><li><a href="/plugchain/zh/features/nft.html" class="sidebar-link">NFT</a></li><li><a href="/plugchain/zh/features/slashing.html" class="sidebar-link">惩罚机制</a></li><li><a href="/plugchain/zh/features/staking.html" class="sidebar-link">Staking</a></li><li><a href="/plugchain/zh/features/upgrade.html" aria-current="page" class="active sidebar-link">软件升级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugchain/zh/features/upgrade.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/plugchain/zh/features/upgrade.html#升级流程" class="sidebar-link">升级流程</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>守护进程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>命令行客户端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务端点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>迁移</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>pvm</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="软件升级"><a href="#软件升级" class="header-anchor">#</a> 软件升级</h1> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="计划"><a href="#计划" class="header-anchor">#</a> 计划</h3> <p>升级模块定义一个 <code>Plan</code>（<code>计划</code>） 类型，该计划调度一个在线升级过程。<code>计划</code> 可以安排在一个特定的区块高度或时间，但不能同时指定两者。一旦对一个（冻结的）候选发布版本以及一个合适的处理器达成一致，则一个 <code>计划</code> 被创建，其 <code>Name</code> 对应一个特定的处理器。通常，<code>计划</code> 通过一个治理提议过程被创建，当投票通过时，该计划将被调度。一个计划的 <code>Info</code> 可以包含关于这次升级的各种元数据，典型的，要包含一些上链的特定于应用的升级信息，诸如验证人能自动升级的 <code>Git</code> 提交。</p> <h4 id="边车进程"><a href="#边车进程" class="header-anchor">#</a> 边车进程</h4> <p>如果一个运行应用程序二进制的运营者也运行一个边车进程来辅助自动下载和升级二进制，<code>Info</code> 允许这个进程是无摩擦的。即，升级模块实现 <a href="https://github.com/cosmos/cosmos-sdk/tree/master/cosmovisor#upgradeable-binary-specification" target="_blank" rel="noopener noreferrer">cosmovisor 可升级的二进制规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 指定的规范，并且 <code>cosmovisor</code> 能可选地被用于为节点运营者完全自动化升级过程。通过用必要的信息填充 <code>Info</code> 字段，二进制能够被自动下载。参考<a href="https://github.com/cosmos/cosmos-sdk/tree/master/cosmovisor#auto-download" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Plan <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name                <span class="token builtin">string</span>
    Time                time<span class="token punctuation">.</span>Time
    Height              <span class="token builtin">int64</span>
    Info                <span class="token builtin">string</span>
    UpgradedClientState <span class="token operator">*</span>types<span class="token punctuation">.</span>Any
<span class="token punctuation">}</span>
</code></pre></div><h3 id="处理器"><a href="#处理器" class="header-anchor">#</a> 处理器</h3> <p><code>升级</code> 模块便于从主版本 X 升级到主版本 Y。为完成这个过程，节点运营者必须首先将当前的二进制升级到一个新二进制，该二进制有一个与新版本 Y 相对应的 <code>处理器</code>。假定这个版本已经过大部分社区成员的充分测试和批准。这个 <code>处理器</code> 定义了在新二进制 Y 成功运行链之前需要完成的状态迁移。当然，这个 <code>处理器</code> 是特定于应用而不是在模块基础上定义的。通过应用中的 <code>Keeper#SetUpgradeHandler</code> 完成 <code>处理器</code> 的注册。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> UpgradeHandler <span class="token keyword">func</span><span class="token punctuation">(</span>Context<span class="token punctuation">,</span> Plan<span class="token punctuation">)</span>
</code></pre></div><p>在每个 <code>BeginBlock</code> 执行期间，<code>升级</code> 模块检查是否存在一个应该执行的 <code>计划</code>（被调度在 <code>BeginBlock</code> 运行时的区块高度或时间）。如果存在，则执行对应的 <code>处理器</code>。如果这个计划期待被执行但没有注册相应的处理器，或者二进制升级过早时，节点将优雅地 <code>panic</code> 并退出。</p> <h3 id="存储加载器"><a href="#存储加载器" class="header-anchor">#</a> 存储加载器</h3> <p>升级模块也有助于将存储迁移作为升级的一部分。<code>存储加载器</code> 执行在新二进制成功运行链之前需要完成的迁移。<code>存储加载器</code> 也是特定于应用而不是基于模块定义的。通过应用中的 <code>app#SetStoreLoader</code> 完成 <code>存储加载器</code> 的注册。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> UpgradeStoreLoader <span class="token punctuation">(</span>upgradeHeight <span class="token builtin">int64</span><span class="token punctuation">,</span> storeUpgrades <span class="token operator">*</span>store<span class="token punctuation">.</span>StoreUpgrades<span class="token punctuation">)</span> baseapp<span class="token punctuation">.</span>StoreLoader
</code></pre></div><p>如果存在一个计划的升级并且已到达升级高度，在 panic 之前旧的二进制将写 <code>升级信息（UpgradeInfo）</code> 到磁盘。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> UpgradeInfo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name    <span class="token builtin">string</span>
    Height  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个信息对于确保 <code>存储升级</code> 在正确的区块高度顺利执行以及确保升级符合预期至关重要。它消除了新二进制每次重启时多次执行 <code>存储升级</code> 的机会。而且，如果在相同的高度存在多个升级计划，<code>Name</code> 将确保这些 <code>存储升级</code> 仅仅发生在计划的升级处理器中。</p> <p>目前在升级过程中，涉及到的状态迁移方式主要支持以下三种：<code>Renamed</code>、<code>Deleted</code>、<code>Added</code></p> <h4 id="renamed"><a href="#renamed" class="header-anchor">#</a> Renamed</h4> <p>用户可以在升级过程中指定将oldKey(前缀)下的所有数据迁移到newKey(前缀)下存储。</p> <h4 id="deleted"><a href="#deleted" class="header-anchor">#</a> Deleted</h4> <p>用户可以在升级过程中删除指定key(前缀)下的所有数据。</p> <h4 id="added"><a href="#added" class="header-anchor">#</a> Added</h4> <p>用户可以在升级过程中以指定key为前缀申请一块新的存储区域。</p> <h3 id="提议"><a href="#提议" class="header-anchor">#</a> 提议</h3> <p>通常，一个 <code>计划</code> 经由 <code>软件升级提议（SoftwareUpgradeProposal）</code> 通过治理的方式被提出并提交，这个提议规定了标准的治理过程。如果这个提议被通过，目标为一个特定 <code>处理器</code> 的 <code>计划</code> 将被持久化并调度。通过在一个新的提议中更新计划时间（<code>Plan.Time</code>），升级可以被推迟或者加速。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> SoftwareUpgradeProposal <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Title       <span class="token builtin">string</span>
    Description <span class="token builtin">string</span>
    Plan        Plan
<span class="token punctuation">}</span>
</code></pre></div><h4 id="治理过程"><a href="#治理过程" class="header-anchor">#</a> 治理过程</h4> <p>当一个升级提议被接受时，升级过程分为如下两个步骤。</p> <h5 id="停止网络共识"><a href="#停止网络共识" class="header-anchor">#</a> 停止网络共识</h5> <p>软件升级提议被接受后，系统将在指定高度的<code>BeginBlock</code>阶段执行升级前的准备，包括下载升级计划、暂停网络共识。</p> <h6 id="下载升级计划"><a href="#下载升级计划" class="header-anchor">#</a> 下载升级计划</h6> <p>为了能够顺利升级软件，必须在停止网络共识之前，先记录升级所需要的信息：<code>计划名称</code>、<code>升级高度</code>。</p> <ul><li><code>计划名称</code>：网络重启时，需要根据计划名称路由到对应的<code>UpgradeHandler</code>以及<code>UpgradeStoreLoader</code>。</li> <li><code>升级高度</code>：网络重启时，检查是否需要执行网络升级计划。</li></ul> <h6 id="暂停网络共识"><a href="#暂停网络共识" class="header-anchor">#</a> 暂停网络共识</h6> <p>软件升级提议被接受后，系统将在指定高度的<code>BeginBlock</code>阶段优雅的暂停网络共识。</p> <h5 id="重新启动新软件"><a href="#重新启动新软件" class="header-anchor">#</a> 重新启动新软件</h5> <p>用户替换软件为指定版本并重新启动网络，系统将检测是否包含<code>计划名称</code>所指定的<code>处理器</code>，如果包含，系统首先执行<code>处理器</code>程序，然后开始网络共识，如果不包含，系统报错并退出。</p> <h4 id="取消升级提议"><a href="#取消升级提议" class="header-anchor">#</a> 取消升级提议</h4> <p>升级提议可以被取消。存在一个 <code>取消软件升级 （CancelSoftwareUpgrade）</code>的提议类型，当该类型提议投票通过时，将移除当前正在进行的升级计划。当然，这需要在升级计划执行之前被投票通过并执行。</p> <p>如果当前升级计划已经被执行，但是该升级计划存在问题，那么此时提出<code>取消软件升级</code>提议是无效的(因为网络已经停止共识)。这时还有另一方案来弥补这一过失，就是在重新启动网络时，使用<code>--unsafe-skip-upgrades</code>参数跳过指定的升级高度(并不是真的跳过该高度，而是跳过软件升级<code>处理器</code>)。当然这要求参与共识的2/3验证人都执行同样的操作，否则同样无法达成网络共识。</p> <h2 id="升级流程"><a href="#升级流程" class="header-anchor">#</a> 升级流程</h2> <h3 id="提交升级提案"><a href="#提交升级提案" class="header-anchor">#</a> 提交升级提案</h3> <p>执行软件升级流程的第一步是由治理模块发起一个软件升级提案，该提案详细说明了升级时间或者升级高度，具体见上面<a href="#%E6%A6%82%E5%BF%B5">概念</a>。发起提案的命令行示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>plugchaind tx gov submit-proposal software-upgrade <span class="token operator">&lt;</span>plan-name<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --deposit <span class="token operator">&lt;</span>deposit<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --upgrade-time <span class="token operator">&lt;</span>upgrade-time<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --title <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --upgrade-info <span class="token operator">&lt;</span>upgrade-info<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --description <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --from<span class="token operator">=</span><span class="token operator">&lt;</span>from<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --chain-id<span class="token operator">=</span><span class="token operator">&lt;</span>chain-id<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --fees<span class="token operator">=</span>20uplugcn <span class="token punctuation">\</span>
  -b block
</code></pre></div><h3 id="为提案抵押、投票"><a href="#为提案抵押、投票" class="header-anchor">#</a> 为提案抵押、投票</h3> <p>软件升级提案和其他普通提案的执行流程基本一致，都需要验证人、委托人为该提案发表意见，具体信息请参考<a href="/plugchain/zh/features/governance.html">治理模块</a>。为提案抵押的命令行示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>plugchaind tx gov deposit <span class="token operator">&lt;</span>proposal-id<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>deposit<span class="token operator">&gt;</span> --from<span class="token operator">=</span><span class="token operator">&lt;</span>from<span class="token operator">&gt;</span> --chain-id<span class="token operator">=</span><span class="token operator">&lt;</span>chain-id<span class="token operator">&gt;</span> --fees<span class="token operator">=</span>20uplugcn -b block -y
</code></pre></div><p>一旦抵押金额达到最小抵押金额，提案将进入投票期，验证人或者委托人需要对该提案发起投票，发起投票的命令行示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>plugchaind tx gov vote <span class="token operator">&lt;</span>proposal-id<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>option<span class="token operator">&gt;</span> --from<span class="token operator">=</span><span class="token operator">&lt;</span>from<span class="token operator">&gt;</span> --chain-id<span class="token operator">=</span><span class="token operator">&lt;</span>chain-id<span class="token operator">&gt;</span> --fees<span class="token operator">=</span>20uplugcnchaind -b block -y
</code></pre></div><p>当软件升级提案被通过后，升级模块会创建一项升级计划，在指定高度或者时间使所有节点停止网络共识，等待新的软件重启网络。</p> <h3 id="重启网络"><a href="#重启网络" class="header-anchor">#</a> 重启网络</h3> <p>当升级提案通过，网络到达指定升级区块高度或时间时，所有节点会停止出块。用户需要根据在第一步<a href="#%E6%8F%90%E4%BA%A4%E5%8D%87%E7%BA%A7%E6%8F%90%E6%A1%88">提交升级提案</a>中指明的新版本信息下载源码，编译新软件，具体参考<a href="/plugchain/zh/get-started/install.html">安装</a>。新软件安装完成后，使用新的版本重启节点。当全网超过2/3的权重的验证人使用新版本启动节点后，区块链网络将重新达成新的共识，继续产生区块。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/plugchain/zh/features/staking.html" class="prev">
        Staking
      </a></span> <span class="next"><a href="/plugchain/zh/daemon/intro.html">
        简介
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/plugchain/assets/js/app.032ebf29.js" defer></script><script src="/plugchain/assets/js/2.27ddde56.js" defer></script><script src="/plugchain/assets/js/114.6b3b13cd.js" defer></script>
  </body>
</html>
